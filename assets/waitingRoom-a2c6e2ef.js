import{b as n}from"./init-e2054226.js";var a=(e=>(e.INSIDE="inside",e.OUTSIDE="outside",e.WALLS="walls",e.START_AREA="startArea",e.CLOCK="clock",e.WELCOME_POP_UP="welcomePopup",e.CLOCK_POP_UP="clockPopUp",e))(a||{});function t(e){c(e.name)}function c(e){let o=WA.ui.openPopup(a.WELCOME_POP_UP,`Welcome : ${e} `,[]);setTimeout(()=>l(o),2e3)}function u(e,o){WA.room.area.onEnter(e).subscribe(async()=>{o()})}function p(e,o){WA.room.area.onEnter(e).subscribe(async()=>{o()})}function i(e){WA.room.area.onEnter(a.CLOCK).subscribe(async()=>{const o=new Date,s=o.getHours()+":"+o.getMinutes();e=WA.ui.openPopup(a.CLOCK_POP_UP,s,[])}),WA.room.area.onLeave(a.CLOCK).subscribe(()=>l(e))}function l(e){e!==void 0&&e.close()}console.log("Script started successfully");let y;const d="startGameBtn";function r(){WA.state.loadVariable("players")||(console.log("players not found, go undefined"),WA.state.saveVariable("players",[]).then());const e=WA.state.loadVariable("players")||[];return console.log("players loaded"),console.log(e),new Set(e)}WA.onInit().then(async()=>{r(),WA.sound.loadSound("../../public/sound/waitingRoom.wav").play({loop:!0}),t(WA.player),u(a.INSIDE,async()=>{if(!WA.player.uuid){console.error("Player UUID not found");return}WA.room.hideLayer(a.WALLS),console.log("player inside");const o=r();o.add(WA.player.uuid),await WA.state.saveVariable("players",Array.from(o))}),p(a.OUTSIDE,async()=>{if(!WA.player.uuid){console.error("Player UUID not found");return}WA.room.showLayer(a.WALLS),console.log("player outside");const o=r();o.delete(WA.player.uuid),await WA.state.saveVariable("players",Array.from(o))}),WA.event.on("teleportPlayer").subscribe(async o=>{console.log(WA.player.uuid||""),console.log(o.data),WA.player.uuid===o.data&&(console.log("teleporting player"),WA.nav.goToRoom("../maps/cds.tmj"))}),WA.state.onVariableChange("players").subscribe(o=>{console.log("players changed",o),console.log("players changed",r())}),i(y),WA.ui.actionBar.addButton({id:d,label:"Start game",callback:()=>{if(console.log("players",r().size),r().size<2){const o=WA.ui.openPopup("popup","You need at least 2 players to start the game",[]);setTimeout(()=>l(o),2e3);return}console.log(Array.from(r().values()));for(const o of Array.from(r().values()))console.log("teleport",o),WA.event.broadcast("teleportPlayer",o)}}),n().then(()=>{console.log("Scripting API Extra ready")}).catch(o=>console.error(o))}).catch(e=>console.error(e));
